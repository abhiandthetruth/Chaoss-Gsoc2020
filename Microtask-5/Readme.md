# Microtask-5
Execute micro-mordred to collect, enrich and visualize data from Git and GitHub repositories.

# Procedure
* Define the setup.cfg. Following is the setup.cfg used by me:
```
[general]
short_name = abhi
update = false
min_update_delay = 10
debug = true
# /var/log/mordred/
logs_dir = logs
# Number of items per bulk request to Elasticsearch
bulk_size = 100
# Number of items to get from Elasticsearch when scrolling
scroll_size = 100
menu_file = ../menu.yaml
aliases_file = ../aliases.json

[projects]
projects_file = ./projects.json

[es_collection]
url = https://admin:admin@localhost:9200

[es_enrichment]
url = https://admin:admin@localhost:9200

[sortinghat]
host = 127.0.0.1
user = root
password = ----
database = abhi_shdb
load_orgs = true
orgs_file = data/orgs_sortinghat.json
identities_api_token = 'xxxx'
identities_file = [data/perceval_identities_sortinghat.json]
affiliate = true
# commonly: Unknown
unaffiliated_group = Unknown
autoprofile = [customer,git,github]
matching = [email]
sleep_for = 120

[panels]
kibiter_time_from= "now-1y"
kibiter_default_index= "git"
kibiter_url = http://admin:admin@localhost:5601
community = true
github-repos = true

[phases]
collection = true
identities = true
enrichment = true
panels = true

[git]
raw_index = git_chaoss
enriched_index = git_chaoss_enriched
#latest-items = true
category = commit
studies = [enrich_demography:git, enrich_areas_of_code:git, enrich_onion:git]

[github]
raw_index = github_issues_chaoss
enriched_index = github_issues_chaoss_enriched
api-token = ----
sleep-for-rate = true
no-archive = true
category = issue

[github:pull]
raw_index = github_pulls_chaoss
enriched_index = github_pulls_chaoss_enriched
api-token = ----
sleep-for-rate = true
no-archive = true
category = pull_request
studies = [enrich_onion:github]

[github:repo]
raw_index = github_pulls_chaoss
enriched_index = github_repo_enriched
category = repository
api-token = ----
no-archive = true

[enrich_demography:git]
date_field = utc_commit
author_field = author_uuid

[enrich_areas_of_code:git]
#no_incremental = true
in_index = git_chaoss
out_index = git-aoc_chaoss_enriched

[enrich_onion:git]
in_index = git_chaoss_enriched
out_index = git-onion_enriched
contribs_field = hash
no_incremental = false

[enrich_onion:github]
#no_incremental = true
in_index_iss = github_issues_chaoss_enriched
in_index_prs = github_pulls_chaoss_enriched
out_index_iss = github_issues_onion-enriched
out_index_prs = github_prs_onion-enriched
data_source_iss = github-issues
data_source_prs = github-prs
```
As you will notice it is simply a tweaked version of the sample config given. A more custom one can be made if asked.
* Define a `project.json`. Following is the file used by me
```
{
    "abhi": {
        "git": [
            "https://github.com/chaoss/grimoirelab-perceval",
            "https://github.com/chaoss/grimoirelab-elk"
        ],
        "github": [
            "https://github.com/chaoss/grimoirelab-perceval",
            "https://github.com/chaoss/grimoirelab-elk"
        ],
        "*github:pull": [
            "https://github.com/chaoss/grimoirelab-perceval",
            "https://github.com/chaoss/grimoirelab-elk"
        ],
        "github:repo": [
            "https://github.com/chaoss/grimoirelab-perceval",
            "https://github.com/chaoss/grimoirelab-elk"
        ]
    }
}
```
I used the chaoss repos since my custom repos don't have much data in them :).
* Add a configuration to pycharm. Give the `Script Pasth` as `grimoirelab-sitmordred/utils/micro.py` or whatever path is applicable to `micro.py` in your system. In the parameters field enter `--raw --enrich --panels --cfg ./setup.cfg --backends github git`. `--raw`, `--enrich` denoting the two types of indices generated by elk, `--panels` denoting that the panels need to be generated, `--cfg` indicating the config file and the as the name suggests `--backends` denotes the list of backends( here `git`, `github`).
* Run this. Note that you should have set up the dev environment already before running it.
* Wait and do not be impatient.

# Results
Indexes are made in elastic search and dashboards added according to the data input. You can see them at `http://localhost:5601/`. Do not forget to login with admin:admin. 

# Attachments
![image](/Microtask-5/image1.png)
![image](/Microtask-5/image2.png)
![image](/Microtask-5/image3.png)
![image](/Microtask-5/image4.png)
![image](/Microtask-5/image5.png)
![image](/Microtask-5/image6.png)
![image](/Microtask-5/image7.png)
